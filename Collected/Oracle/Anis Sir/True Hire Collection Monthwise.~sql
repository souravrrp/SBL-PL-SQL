--Current Collection of True Hire Accounts
--Positive Collection
select --c.*,
       c.contract,
       c.account_no,
       c.original_acc_no,
       c.receipt_no,
       c.amount amount,
       c.payment_date,
       c.pay_method,
       c.rowstate    
from   ifsapp.SBL_COLLECTION_INFO c
where  c.payment_date between to_date('&from_date', 'YYYY/MM/DD') and to_date('&to_date', 'YYYY/MM/DD') 
and    c.contract like '&site'
and    c.account_no in (select h.acct_no 
                        from   HPNRET_FORM249_ARREARS_TAB h
                        where  h.year = extract(year from to_date('&from_date', 'YYYY/MM/DD'))
                        and    h.period = extract(month from to_date('&from_date', 'YYYY/MM/DD'))
                        and    trunc(h.cash_conversion_on_date) < to_date('&from_date', 'YYYY/MM/DD'))
  

union


--Negative Collection
SELECT r.contract,
       r.order_no account_no,
       c.original_acc_no,
       c.receipt_no,
       (-1) * c.amount amount,
       r.date_returned,
       c.pay_method,
       c.rowstate            
FROM   ifsapp.SBL_RETURN_INFO r,
       ifsapp.SBL_COLLECTION_INFO c
WHERE  r.order_no = c.account_no 
and    r.contract = c.contract 
and    r.date_returned between to_date('&from_date', 'YYYY/MM/DD') and to_date('&to_date', 'YYYY/MM/DD') 
and    c.contract like '&site'
and    r.order_no in (select h.acct_no 
                      from   HPNRET_FORM249_ARREARS_TAB h
                      where  h.year = extract(year from to_date('&from_date', 'YYYY/MM/DD'))
                      and    h.period = extract(month from to_date('&from_date', 'YYYY/MM/DD'))
                      and    trunc(h.cash_conversion_on_date) < to_date('&from_date', 'YYYY/MM/DD'))


union


--New True Hire Account Old Collection
--Previous Postive Collections of New True Hire
select c.contract,
       c.account_no,
       c.original_acc_no,
       c.receipt_no,
       c.amount amount,
       c.payment_date,
       c.pay_method,
       c.rowstate    
from   ifsapp.SBL_COLLECTION_INFO c
where  c.payment_date < to_date('&from_date', 'YYYY/MM/DD') 
and    c.contract like '&site'
and    c.account_no in (select h.acct_no 
                        from   HPNRET_FORM249_ARREARS_TAB h
                        where  h.year = extract(year from to_date('&from_date', 'YYYY/MM/DD'))
                        and    h.period = extract(month from to_date('&from_date', 'YYYY/MM/DD'))
                        and    trunc(h.cash_conversion_on_date) between trunc(trunc(to_date('&from_date', 'YYYY/MM/DD'), 'mm') - 1, 'mm') and
                                                                        trunc(to_date('&from_date', 'YYYY/MM/DD'), 'mm') - 1)


union


--Previous Negative Collection of New True Hire 
SELECT r.contract,
       r.order_no account_no,
       c.original_acc_no,
       c.receipt_no,
       (-1) * c.amount amount,
       r.date_returned,
       c.pay_method,
       c.rowstate            
FROM   ifsapp.SBL_RETURN_INFO r,
       ifsapp.SBL_COLLECTION_INFO c
WHERE  r.order_no = c.account_no 
and    r.contract = c.contract 
and    r.date_returned < to_date('&from_date', 'YYYY/MM/DD') 
and    c.contract like '&site'
and    r.order_no in (select h.acct_no 
                        from   HPNRET_FORM249_ARREARS_TAB h
                        where  h.year = extract(year from to_date('&from_date', 'YYYY/MM/DD'))
                        and    h.period = extract(month from to_date('&from_date', 'YYYY/MM/DD'))
                        and    trunc(h.cash_conversion_on_date) between trunc(trunc(to_date('&from_date', 'YYYY/MM/DD'), 'mm') - 1, 'mm') and
                                                                        trunc(to_date('&from_date', 'YYYY/MM/DD'), 'mm') - 1)
